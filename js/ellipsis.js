!function(){"use strict";var t={ellipsis:"â€¦",debounce:0,responsive:!0,className:".clamp",lines:2,portrait:null,break_word:!0},s=0,l=!!window.requestAnimationFrame,n=function(e,i){var t,n=s+=1;t=n,i.setAttribute("data-ellipsis-id",t),e[n]=e[n]||{},e[n].element=i,e[n].innerHTML=i.innerHTML},r=function(t){return Object.keys(t).map(function(e,i){return t[e].element})};function i(e){var i=function(e,i){var t={};for(var n in e)t[n]=e[n];for(var s in i)t[s]=i[s];return t}(t,e||{});this.create(i),this.add()}i.prototype={conf:{},prop:{},lines:{},temp:null,listener:null,create:function(e){if(this.conf=e,this.lines={get current(){if(e.portrait&&window.innerHeight>window.innerWidth)return e.portrait;else return e.lines}},this.conf.responsive){this.temp={};var i,t=this.conf.debounce;if(l&&!t){this._isScheduled=!1;var n=this;i=function(e){if(!n._isScheduled)n._isScheduled=!0,window.requestAnimationFrame(function(){n._isScheduled=!1,n.add(r(n.temp))})}}else{var s;t=t||16,i=function(e){clearTimeout(s),s=setTimeout(function(){this.add(r(this.temp))}.bind(this),t)}}this.listener=i.bind(this),window.addEventListener("resize",this.listener,!1),window.removeEventListener("beforeunload",this.listener,!1)}},destroy:function(){this.listener&&window.removeEventListener("resize",this.listener,!1)},createProp:function(i){this.prop={get height(){var e=i.getBoundingClientRect();return parseInt(e.bottom-e.top,10)},get lineheight(){var e=getComputedStyle(i).getPropertyValue("line-height");if(-1<String("normal|initial|inherit").indexOf(e))e=parseInt(getComputedStyle(i).getPropertyValue("font-size"),10)+2;return parseInt(e,10)}}},add:function(e){if(!e&&this.conf.className)e=document.querySelectorAll(this.conf.className);if(e)if(e.length)for(var i=0;i<e.length;i++)this.addElement(e[i]);else if(void 0===e.length)this.addElement(e)},addElement:function(e){if(this.conf.responsive){var i=function(e,i){if(e)return e[(t=i,t.getAttribute("data-ellipsis-id"))];else return null;var t}(this.temp,e);if(!i)n(this.temp,e);else if(e.innerHTML!==i.innerHTML)e.innerHTML=i.innerHTML}if(this.createProp(e),this.isNotCorrect())if(e.childNodes.length&&1<e.childNodes.length)this.handleChildren(e);else if(e.childNodes.length&&1===e.childNodes.length&&3===e.childNodes[0].nodeType)this.simpleText(e)},breakWord:function(e,i,t){var n=e.split(" ");if(n.pop(),t)n.pop();if(!i){if(n[n.length-1])n[n.length-1]=n[n.length-1].replace(/(,$)/g,"").replace(/(\.$)/g,"");return n.push(this.conf.ellipsis),n.join(" ")}else if(n[n.length-1])return n[n.length-1]=n[n.length-1].replace(/(,$)/g,"").replace(/(\.$)/g,""),n.push(this.conf.ellipsis),[n.join(" "),i];else if(!n[n.length-1]&&i){var s=" "+i.trim().replace(/(,$)/g,"").replace(/(\.$)/g,"")+" ";return n.push(this.conf.ellipsis),[n.join(" "),s]}},simpleText:function(e){for(var i=e.childNodes[0].nodeValue;this.prop.height>this.prop.lineheight*this.lines.current;)e.childNodes[0].nodeValue=i.slice(0,-1),i=e.childNodes[0].nodeValue;if(this.conf.break_word){if(e.childNodes[0].nodeValue=i.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect())e.childNodes[0].nodeValue=" "+e.childNodes[0].nodeValue.slice(0,-(this.conf.ellipsis.length+1)).trim().slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis}else if(e.childNodes[0].nodeValue=this.breakWord(e.childNodes[0].nodeValue),this.isNotCorrect())e.childNodes[0].nodeValue=this.breakWord(e.childNodes[0].nodeValue,null,!0)},isNotCorrect:function(){return this.prop.height>this.prop.lineheight*this.lines.current},processBreak:function(e,i,t){var n=this.breakWord(e.innerText||e.nodeValue,i.innerText||i.nodeValue,t);if(e.innerText)e.innerText=n[0];else e.nodeValue=n[0];if(i.innerText)i.innerText=n[1];else i.nodeValue=n[1]},handleChildren:function(e){for(var i,t=e.childNodes,n=t.length-1;0<=n;n--){var s;if(8!==t[n].nodeType){if(3===t[n].nodeType)s=t[n].nodeValue,t[n].nodeValue="";else s=getComputedStyle(t[n]).getPropertyValue("display"),t[n].style.display="none";if(this.prop.height<=this.prop.lineheight*this.lines.current){if(3===t[n].nodeType){for(t[n].nodeValue=s,i=t[n].nodeValue;this.prop.height>this.prop.lineheight*this.lines.current;)t[n].nodeValue=i.slice(0,-1),i=t[n].nodeValue;if(this.conf.break_word){if(t[n].nodeValue=i.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect())if(t[n].nodeValue=" "+t[n].nodeValue.slice(0,-this.conf.ellipsis.length).trim().slice(0,-this.conf.ellipsis.length),1<t[n].nodeValue.length)t[n].nodeValue=t[n].nodeValue.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis;else continue}else{if(!t[n].innerText&&!t[n].nodeValue)continue;if(this.processBreak(t[n],t[n-1]),this.isNotCorrect())if(this.processBreak(t[n],t[n-1],!0),this.isNotCorrect()){e.removeChild(t[n]);continue}}}else{for(t[n].style.display=s,i=t[n].innerText;this.prop.height>this.prop.lineheight*this.lines.current;)t[n].innerText=i.slice(0,-1),i=t[n].innerText;if(this.conf.break_word){if(t[n].innerText=i.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect())if(t[n].innerText=" "+t[n].innerText.slice(0,-this.conf.ellipsis.length).trim().slice(0,-this.conf.ellipsis.length),1<t[n].innerText.length)t[n].innerText=t[n].innerText.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis;else continue}else{if(!t[n].innerText&&!t[n].nodeValue)continue;if(this.processBreak(t[n],t[n-1]),this.isNotCorrect())if(this.processBreak(t[n],t[n-1],!0),this.isNotCorrect()){e.removeChild(t[n]);continue}}}break}else e.removeChild(t[n])}}}};var e=function(e){return new i(e)};if("function"==typeof define&&define.amd)define("ellipsis",[],function(){return e});self.Ellipsis=e}();